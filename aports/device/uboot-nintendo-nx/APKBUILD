pkgname=uboot-nintendo-nx
pkgver=2018.01
pkgrel=0
pkgdesc="Fail0verflow's U-Boot port for the Switch, used as a Coreboot payload."
url="https://github.com/fail0verflow/switch-u-boot"
# Note: this should be a aarch64 package, but
# this is need by native chroot as a makedepend for coreboot-nintendo-nx
# So it must be noarch with !archcheck
arch="noarch"
license="GPL-2.0-or-later"
depends=""
makedepends="gcc-aarch64 g++-aarch64 ccache-cross-symlinks python-dev swig"
install=""
options="!archcheck"

_repository="switch-u-boot"
_commit="a2d885d448eacb72085f262f9b28951384a8e678"
source="
	$pkgname-$_commit.tar.gz::https://github.com/fail0verflow/${_repository}/archive/${_commit}.tar.gz
"
builddir="$srcdir/${_repository}-${_commit}"

build() {
	cd "$builddir"
	export CROSS_COMPILE=aarch64-alpine-linux-musl-
	make nintendo-switch_defconfig
	make
}

check() {
	cd "$builddir"
}

package() {
	cd "$builddir"
	install -D "u-boot.elf" \
		"$pkgdir/usr/share/uboot-nintendo-nx/u-boot.elf"
}

sha512sums="d3db8298f9a7e922bae074c2fa6ca8ad643478e848a3777b3bd732c9e4d2e515eeb310042077e1d168075406ee6a2cfeb7c7b5059d0ff146dc79914dcea3eb91  uboot-nintendo-nx-a2d885d448eacb72085f262f9b28951384a8e678.tar.gz"
