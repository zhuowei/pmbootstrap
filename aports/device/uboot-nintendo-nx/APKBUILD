pkgname=uboot-nintendo-nx
pkgver=2018.01
pkgrel=0
pkgdesc="Fail0verflow's U-Boot port for the Switch, used as a Coreboot payload. This includes natinusala's patch for SD card boot."
url="https://github.com/natinusala/switch-u-boot"
# Note: this should be a aarch64 package, but
# this is need by native chroot as a makedepend for coreboot-nintendo-nx
# So it must be noarch with !archcheck
arch="noarch"
license="GPL-2.0-or-later"
depends=""
makedepends="gcc-aarch64 g++-aarch64 ccache-cross-symlinks python-dev swig"
install=""
options="!archcheck"

_repository="switch-u-boot"
_commit="9f08090e970178c77f148e2440f5e55b94690663"
source="
	$pkgname-$_commit.tar.gz::https://github.com/natinusala/${_repository}/archive/${_commit}.tar.gz
"
builddir="$srcdir/${_repository}-${_commit}"

build() {
	cd "$builddir"
	export CROSS_COMPILE=aarch64-alpine-linux-musl-
	make nintendo-switch_defconfig
	make
}

check() {
	cd "$builddir"
}

package() {
	cd "$builddir"
	install -D "u-boot.elf" \
		"$pkgdir/usr/share/uboot-nintendo-nx/u-boot.elf"
}

sha512sums="0ee3badde2466966ffca30d8cbda01bd1e82e4a505655d8533906a0fbd63119204135fd4b42b2aff27beced882143b60cb8a92c44398dda7c26d97b3126ba13b  uboot-nintendo-nx-9f08090e970178c77f148e2440f5e55b94690663.tar.gz"
